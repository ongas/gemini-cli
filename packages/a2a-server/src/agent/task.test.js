/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
import { describe, it, expect, vi } from 'vitest';
import { Task } from './task.js';
import { createMockConfig } from '../utils/testing_utils.js';
describe('Task', () => {
    it('scheduleToolCalls should not modify the input requests array', async () => {
        const mockConfig = createMockConfig();
        const mockEventBus = {
            publish: vi.fn(),
            on: vi.fn(),
            off: vi.fn(),
            once: vi.fn(),
            removeAllListeners: vi.fn(),
            finished: vi.fn(),
        };
        // The Task constructor is private. We'll bypass it for this unit test.
        // @ts-expect-error - Calling private constructor for test purposes.
        const task = new Task('task-id', 'context-id', mockConfig, mockEventBus);
        task['setTaskStateAndPublishUpdate'] = vi.fn();
        task['getProposedContent'] = vi.fn().mockResolvedValue('new content');
        const requests = [
            {
                callId: '1',
                name: 'replace',
                args: {
                    file_path: 'test.txt',
                    old_string: 'old',
                    new_string: 'new',
                },
                isClientInitiated: false,
                prompt_id: 'prompt-id-1',
            },
        ];
        const originalRequests = JSON.parse(JSON.stringify(requests));
        const abortController = new AbortController();
        await task.scheduleToolCalls(requests, abortController.signal);
        expect(requests).toEqual(originalRequests);
    });
});
//# sourceMappingURL=task.test.js.map